// Requires gradle 6.5
// gradle clean build

plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

sourceCompatibility = '11'
targetCompatibility = '11'

sourceSets {
    main {
        java {
            srcDirs += ["src/gen/java"]
        }
    }
}

jar { 
    manifest { 
        attributes 'Class-Path': configurations.compile.collect { it.getName() }.join(' ')
    }
}

java {
    modularity.inferModulePath = true
}

def releaseDir = "release/${projectName}/${projectName}"
def releaseFileName = "${projectName}-${version}.zip"

task packageDistribution(type: Zip) {
    archiveFileName = "$releaseFileName"
    destinationDirectory = file("$projectDir/release")
    from file("$projectDir/release/$projectName")
}

packageDistribution.doLast {
    delete "$projectDir/release/$projectName"
}

task copyLibs(type: Copy) {
    from "bld/liblibrealsense2-jni.so"
    from jar.archiveFile
    into "${releaseDir}/libs"
}

task createRelease(type: Copy, dependsOn: copyLibs) {
    from "README.md"
    into releaseDir
}

task cleanRelease(type: Delete) {
    delete "$projectDir/release"
}

packageDistribution.dependsOn createRelease
assemble.dependsOn packageDistribution
clean.dependsOn cleanRelease
